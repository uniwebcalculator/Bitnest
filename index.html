<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BitNest Calculator</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #0d0d0d;
      color: #eaeaea;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 0.5rem;
      background: #111;
      border-bottom: 1px solid #222;
    }
    header h1 {
      font-size: 1.2rem;
      color: #00ff88;
      margin: 0;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 1rem;
      font-size: 0.85rem;
    }

    /* Input rows */
    .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .form-row label {
      min-width: 80px;
      font-size: 0.8rem;
      color: #aaa;
    }
    .form-row input {
      flex: 1;
      padding: 0.35rem 0.5rem;
      border: 1px solid #333;
      border-radius: 6px;
      background: #0d0d0d;
      color: #00ff88;
      text-align: left;
      font-size: 0.8rem;
    }

    /* Buttons */
    .btn {
      background: linear-gradient(90deg, #00ff88, #00ccff);
      border: none;
      border-radius: 15px;
      color: #000;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
      margin: 0.2rem;
    }
    .btn:hover { opacity: 0.85; }

    /* Tabs */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 0.3rem;
      margin: 0.6rem 0;
    }
    .tabs button {
      background: #1a1a1a;
      color: #888;
      border: none;
      border-radius: 10px;
      padding: 0.3rem 0.8rem;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .tabs button.active {
      background: linear-gradient(90deg, #00ff88, #00ccff);
      color: #000;
      font-weight: 600;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Summary */
    .summary h2 {
      color: #00ff88;
      margin: 0.6rem 0;
      font-size: 0.9rem;
      text-align: center;
    }
    .summary .level {
      margin-bottom: 0.8rem;
      font-size: 0.8rem;
      line-height: 1.2rem;
    }
    .summary .level strong {
      color: #00ccff;
    }
    .summary .total {
      margin-top: 0.8rem;
      font-size: 0.9rem;
      font-weight: bold;
      color: #00ccff;
      text-align: center;
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.75rem;
    }
    table th, table td {
      border: 1px solid #222;
      padding: 0.3rem;
      text-align: center;
    }
    table th {
      background: #111;
      color: #00ff88;
    }
    table td { background: #0d0d0d; }
  </style>
</head>
<body>
  <header>
    <h1>BitNest Calculator</h1>
  </header>
  <div class="container">
    <!-- Inputs -->
    <div class="form-row">
      <label for="cycles">Cycles</label>
      <input type="number" id="cycles" value="1" min="1">
    </div>
    <div class="form-row">
      <label for="initiator">Initiator</label>
      <input type="number" id="initiator" value="100" placeholder="0">
    </div>
    <div class="form-row">
      <label for="l1">Level 1</label>
      <input type="number" id="l1" placeholder="0">
    </div>
    <div class="form-row">
      <label for="l2">Level 2</label>
      <input type="number" id="l2" placeholder="0">
    </div>
    <div class="form-row">
      <label for="l3">Level 3</label>
      <input type="number" id="l3" placeholder="0">
    </div>

    <div style="text-align:center; margin:0.5rem 0;">
      <button class="btn" onclick="calculate()">Calculate</button>
      <button class="btn" onclick="downloadCSV()">CSV</button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="active" onclick="switchTab(event,'summary')">Summary</button>
      <button onclick="switchTab(event,'cycleDetails')">Cycle Details</button>
    </div>
    
    <div id="summary" class="tab-content active summary"></div>
    <div id="cycleDetails" class="tab-content"></div>
  </div>

  <script>
    const ROI_RATE = 0.24;
    let lastCSV = [];

    function makeSummary(name, start, roi, ref, total){
      const growth = start>0 ? ((total/start-1)*100).toFixed(1) : 0;
      return `<div class="level"><strong>${name}</strong><br>
        Initial: ${start.toFixed(2)}<br>
        ROI: ${roi.toFixed(2)}<br>
        Referral: ${ref.toFixed(2)}<br>
        Final: ${total.toFixed(2)}<br>
        Growth: ${growth}%</div>`;
    }

    function calculate(){
      let cycles = Number(document.getElementById("cycles").value);
      let initiator = Number(document.getElementById("initiator").value) || 0;
      let l1 = Number(document.getElementById("l1").value) || 0;
      let l2 = Number(document.getElementById("l2").value) || 0;
      let l3 = Number(document.getElementById("l3").value) || 0;

      const startIni = initiator, startL1 = l1, startL2 = l2, startL3 = l3;
      let iniROI=0,iniRef=0,l1ROI=0,l1Ref=0,l2ROI=0,l2Ref=0,l3ROI=0,l3Ref=0;
      let cycleRows="", csvRows=[["Cycle"]];

      if(startIni>0) csvRows[0].push("Ini Profit","Ini Ref","Ini Total","Ini %");
      if(startL1>0) csvRows[0].push("L1 Profit","L1 Ref","L1 Total","L1 %");
      if(startL2>0) csvRows[0].push("L2 Profit","L2 Ref","L2 Total","L2 %");
      if(startL3>0) csvRows[0].push("L3 Profit","L3 Ref","L3 Total","L3 %");
      csvRows[0].push("Network");

      for(let i=1;i<=cycles;i++){
        const iniProfit = initiator*ROI_RATE;
        const l1Profit = l1*ROI_RATE;
        const l2Profit = l2*ROI_RATE;
        const l3Profit = l3*ROI_RATE;

        const iniRefEarn = 0.2*l1Profit+0.1*l2Profit+0.05*l3Profit;
        const l1RefEarn = 0.2*l2Profit+0.1*l3Profit;
        const l2RefEarn = 0.2*l3Profit;
        const l3RefEarn = 0;

        iniROI+=iniProfit; iniRef+=iniRefEarn;
        l1ROI+=l1Profit; l1Ref+=l1RefEarn;
        l2ROI+=l2Profit; l2Ref+=l2RefEarn;
        l3ROI+=l3Profit; l3Ref+=l3RefEarn;

        initiator+=iniProfit+iniRefEarn;
        l1+=l1Profit+l1RefEarn;
        l2+=l2Profit+l2RefEarn;
        l3+=l3Profit+l3RefEarn;

        const net=initiator+l1+l2+l3;
        cycleRows += `<tr><td>${i}</td>`;
        let row=[i];

        if(startIni>0){
          let growth=((initiator/startIni-1)*100).toFixed(1);
          cycleRows+=`<td>${iniProfit.toFixed(2)}+${iniRefEarn.toFixed(2)}</td><td>${initiator.toFixed(2)}</td><td>${growth}%</td>`;
          row.push(iniProfit.toFixed(2),iniRefEarn.toFixed(2),initiator.toFixed(2),growth+"%");
        }
        if(startL1>0){
          let growth=((l1/startL1-1)*100).toFixed(1);
          cycleRows+=`<td>${l1Profit.toFixed(2)}+${l1RefEarn.toFixed(2)}</td><td>${l1.toFixed(2)}</td><td>${growth}%</td>`;
          row.push(l1Profit.toFixed(2),l1RefEarn.toFixed(2),l1.toFixed(2),growth+"%");
        }
        if(startL2>0){
          let growth=((l2/startL2-1)*100).toFixed(1);
          cycleRows+=`<td>${l2Profit.toFixed(2)}+${l2RefEarn.toFixed(2)}</td><td>${l2.toFixed(2)}</td><td>${growth}%</td>`;
          row.push(l2Profit.toFixed(2),l2RefEarn.toFixed(2),l2.toFixed(2),growth+"%");
        }
        if(startL3>0){
          let growth=((l3/startL3-1)*100).toFixed(1);
          cycleRows+=`<td>${l3Profit.toFixed(2)}+${l3RefEarn.toFixed(2)}</td><td>${l3.toFixed(2)}</td><td>${growth}%</td>`;
          row.push(l3Profit.toFixed(2),l3RefEarn.toFixed(2),l3.toFixed(2),growth+"%");
        }

        cycleRows+=`<td>${net.toFixed(2)}</td></tr>`;
        row.push(net.toFixed(2));
        csvRows.push(row);
      }

      let summaryHTML=`<h2>Summary after ${cycles} cycles</h2>`;
      if(startIni>0) summaryHTML+=makeSummary("Initiator",startIni,iniROI,iniRef,initiator);
      if(startL1>0) summaryHTML+=makeSummary("Level 1",startL1,l1ROI,l1Ref,l1);
      if(startL2>0) summaryHTML+=makeSummary("Level 2",startL2,l2ROI,l2Ref,l2);
      if(startL3>0) summaryHTML+=makeSummary("Level 3",startL3,l3ROI,l3Ref,l3);
      summaryHTML+=`<div class="total">Network Total: ${(initiator+l1+l2+l3).toFixed(2)}</div>`;
      document.getElementById("summary").innerHTML=summaryHTML;

      let header="<tr><th>Cycle</th>";
      if(startIni>0) header+="<th>Ini (P+R)</th><th>Total</th><th>%</th>";
      if(startL1>0) header+="<th>L1 (P+R)</th><th>Total</th><th>%</th>";
      if(startL2>0) header+="<th>L2 (P+R)</th><th>Total</th><th>%</th>";
      if(startL3>0) header+="<th>L3 (P+R)</th><th>Total</th><th>%</th>";
      header+="<th>Network</th></tr>";

      document.getElementById("cycleDetails").innerHTML=
        `<div style="overflow-x:auto"><table><thead>${header}</thead><tbody>${cycleRows}</tbody></table></div>`;

      lastCSV = csvRows;
    }

    function switchTab(evt,id){
      document.querySelectorAll(".tab-content").forEach(div=>div.classList.remove("active"));
      document.querySelectorAll(".tabs button").forEach(btn=>btn.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      evt.target.classList.add("active");
    }

    function downloadCSV(){
      if(!lastCSV.length){ alert("Please calculate first!"); return; }
      let csv=lastCSV.map(r=>r.join(",")).join("\n");
      let blob=new Blob([csv],{type:"text/csv"});
      let url=URL.createObjectURL(blob);
      let a=document.createElement("a");
      a.href=url; a.download="bitnest_calculator.csv";
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
  </script>
</body>
</html>